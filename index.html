<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>분수 통분 오목 게임</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f8f8f8;
      padding: 10px;
    }
    h1 {
      margin-top: 20px;
      font-size: 1.5em;
      text-align: center;
    }
    #turnInfo {
      margin-top: 10px;
      font-size: 1em;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-top: 20px;
      width: 100%;
      max-width: 1000px;
    }
    .cell {
      background-color: white;
      border: 2px solid #aaa;
      padding: 10px;
      text-align: center;
      width: 100%;
      height: 140px;
      box-sizing: border-box;
    }
    .cell.correct.player1 {
      background-color: #aee1f9;
    }
    .cell.correct.player2 {
      background-color: #f9b2b2;
    }
    .fractions {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 5px;
    }
    .fraction-display {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .fraction-display .line {
      width: 30px;
      border-top: 1px solid black;
      margin: 2px 0;
    }
    .inputs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 5px;
    }
    .fraction-input {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .fraction-input input {
      width: 30px;
      text-align: center;
    }
    .fraction-line {
      width: 30px;
      border-top: 1px solid black;
      margin: 2px 0;
    }
    button {
      font-size: 12px;
    }
    #resetBtn {
      margin-top: 15px;
      padding: 5px 10px;
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.2em;
      }
      .cell {
        height: 120px;
        font-size: 0.9em;
      }
      .fraction-display .line,
      .fraction-line,
      .fraction-input input {
        width: 24px;
      }
    }
  </style>
</head>
<body>
  <h1>분수 통분 오목 게임</h1>
  <div id="turnInfo">현재 차례: 플레이어 1</div>
  <button id="resetBtn" onclick="location.reload()">다시 시작</button>
  <div id="board"></div>

  <script>
    const board = document.getElementById("board");
    const turnInfo = document.getElementById("turnInfo");
    const SIZE = 7;
    let currentPlayer = 1;
    let gameOver = false;
    let state = Array.from({ length: SIZE }, () => Array(SIZE).fill(null));
let usedFractions = new Set();

    function getGCD(a, b) {
      return b === 0 ? a : getGCD(b, a % b);
    }

    function getRandomFraction() {
      let num, den, gcd;
      do {
        num = Math.floor(Math.random() * 4 + 1);
        den = Math.floor(Math.random() * 5 + 2);
        gcd = getGCD(num, den);
      } while (gcd !== 1 || num >= den);
      return `${num}/${den}`;
    }

    function getTwoDistinctFractions() {
  let f1, f2;
  let parsed1, parsed2;
  let tries = 0;
  do {
    f1 = getRandomFraction();
    f2 = getRandomFraction();
    parsed1 = toImproper(f1);
    parsed2 = toImproper(f2);
    tries++;
  } while (
    (parsed1.d === parsed2.d || parsed1.n * parsed2.d === parsed2.n * parsed1.d || usedFractions.has(f1 + ',' + f2)) && tries < 100
  );
  usedFractions.add(f1 + ',' + f2);
  return [f1, f2];
    }

    function toImproper(fraction) {
      const [n, d] = fraction.split("/").map(Number);
      return { n, d };
    }

    function areEquivalent(f1, n, d) {
      const a = toImproper(f1);
      return a.n * d === n * a.d;
    }

    function checkWin(r, c, player) {
      const directions = [
        [1, 0], [0, 1], [1, 1], [1, -1]
      ];
      for (let [dr, dc] of directions) {
        let count = 1;
        for (let dir of [-1, 1]) {
          let nr = r + dr * dir;
          let nc = c + dc * dir;
          while (
            nr >= 0 && nr < SIZE &&
            nc >= 0 && nc < SIZE &&
            state[nr][nc] === player
          ) {
            count++;
            nr += dr * dir;
            nc += dc * dir;
          }
        }
        if (count >= 4) return true;
      }
      return false;
    }

    function createFractionInput() {
      const wrap = document.createElement("div");
      wrap.className = "fraction-input";
      const top = document.createElement("input");
      const line = document.createElement("div");
      line.className = "fraction-line";
      const bottom = document.createElement("input");
      wrap.appendChild(top);
      wrap.appendChild(line);
      wrap.appendChild(bottom);
      return { wrap, top, bottom };
    }

    function createFractionDisplay(fraction) {
      const { n, d } = toImproper(fraction);
      const wrap = document.createElement("div");
      wrap.className = "fraction-display";
      const top = document.createElement("div");
      top.textContent = n;
      const line = document.createElement("div");
      line.className = "line";
      const bottom = document.createElement("div");
      bottom.textContent = d;
      wrap.appendChild(top);
      wrap.appendChild(line);
      wrap.appendChild(bottom);
      return wrap;
    }

    function createCell(r, c) {
      const cell = document.createElement("div");
      cell.className = "cell";
      const [f1, f2] = getTwoDistinctFractions();

      const fracDiv = document.createElement("div");
      fracDiv.className = "fractions";
      fracDiv.appendChild(createFractionDisplay(f1));
      fracDiv.appendChild(createFractionDisplay(f2));

      const { wrap: f1Wrap, top: f1Num, bottom: f1Den } = createFractionInput();
      const { wrap: f2Wrap, top: f2Num, bottom: f2Den } = createFractionInput();

      const inputWrap = document.createElement("div");
      inputWrap.className = "inputs";
      inputWrap.appendChild(f1Wrap);
      inputWrap.appendChild(f2Wrap);

      const checkBtn = document.createElement("button");
      checkBtn.textContent = "제출";

      const hintBtn = document.createElement("button");
      hintBtn.textContent = "힌트 보기";
      hintBtn.onclick = () => {
        const answer1 = toImproper(f1);
        const answer2 = toImproper(f2);
        const lcm = answer1.d * answer2.d / getGCD(answer1.d, answer2.d);
        f1Num.value = answer1.n * (lcm / answer1.d);
        f1Den.value = lcm;
        f2Num.value = answer2.n * (lcm / answer2.d);
        f2Den.value = lcm;
      };
      

      checkBtn.onclick = () => {
        if (cell.classList.contains("correct") || gameOver) return;
        const n1 = Number(f1Num.value);
        const d1 = Number(f1Den.value);
        const n2 = Number(f2Num.value);
        const d2 = Number(f2Den.value);

        if (!n1 || !d1 || !n2 || !d2 || d1 === 0 || d2 === 0) {
          alert("모든 입력란에 올바른 값을 입력해주세요.");
          return;
        }

        if (
          areEquivalent(f1, n1, d1) &&
          areEquivalent(f2, n2, d2) &&
          d1 === d2
        ) {
          cell.classList.add("correct", `player${currentPlayer}`);
          state[r][c] = currentPlayer;
          if (checkWin(r, c, currentPlayer)) {
            const color = currentPlayer === 1 ? '하늘색' : '분홍색';
            alert(`${color} 플레이어 승리!`);
            gameOver = true;
            return;
          }
          currentPlayer = currentPlayer === 1 ? 2 : 1;
          turnInfo.textContent = `현재 차례: 플레이어 ${currentPlayer}`;
        } else {
          alert("틀렸습니다. 다시 시도하세요.");
        }
      };

      cell.appendChild(fracDiv);
      cell.appendChild(inputWrap);
      cell.appendChild(hintBtn);
      cell.appendChild(checkBtn);
      board.appendChild(cell);
    }

    for (let r = 0; r < SIZE; r++) {
      for (let c = 0; c < SIZE; c++) {
        createCell(r, c);
      }
    }
</script>
</body>
</html>
