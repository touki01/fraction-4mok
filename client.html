<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì‹¤ì‹œê°„ ë¶„ìˆ˜ í†µë¶„ ì˜¤ëª©</title>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f0f0; padding: 10px; }
    #board { display: grid; grid-template-columns: repeat(7, 1fr); max-width: 600px; margin: auto; gap: 5px; }
    .cell { background: #fff; border: 1px solid #ccc; height: 60px; line-height: 60px; font-size: 24px; cursor: pointer; }
    .cell.player1 { background: #aee1f9; }
    .cell.player2 { background: #f9b2b2; }
  </style>
</head>
<body>
  <h1>ì‹¤ì‹œê°„ ë¶„ìˆ˜ í†µë¶„ ì˜¤ëª©</h1>
  <p id="status">ì—°ê²° ì¤‘...</p>
  <div id="board"></div>

  <script>
    const socket = io("https://fraction-4mok.onrender.com");
    const boardEl = document.getElementById("board");
    const status = document.getElementById("status");
    const SIZE = 7;
    let player = 0;
    let myTurn = false;

    function drawBoard(board) {
      boardEl.innerHTML = "";
      board.forEach((row, r) => {
        row.forEach((cell, c) => {
          const div = document.createElement("div");
          div.className = "cell" + (cell ? ` player${cell}` : "");
          div.onclick = () => {
            if (myTurn && !cell) socket.emit("submit", { row: r, col: c });
          };
          boardEl.appendChild(div);
        });
      });
    }

    socket.on("connect", () => {
      status.textContent = "ê²Œì„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€ê¸° ì¤‘...";
    });

    socket.on("full", () => {
      status.textContent = "ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.";
    });

    socket.on("playerNumber", (num) => {
      player = num;
      status.textContent = `ë‹¹ì‹ ì€ í”Œë ˆì´ì–´ ${num}ì…ë‹ˆë‹¤.`;
    });

    socket.on("boardUpdate", ({ board, currentPlayer }) => {
      drawBoard(board);
      myTurn = currentPlayer === player;
      status.textContent = myTurn ? "ë‹¹ì‹ ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤." : "ìƒëŒ€ ì°¨ë¡€ì…ë‹ˆë‹¤.";
    });

    socket.on("moveMade", ({ row, col, player }) => {
      const index = row * SIZE + col;
      const cell = boardEl.children[index];
      if (cell) cell.className = `cell player${player}`;
    });

    socket.on("turnUpdate", (cp) => {
      myTurn = cp === player;
      status.textContent = myTurn ? "ë‹¹ì‹ ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤." : "ìƒëŒ€ ì°¨ë¡€ì…ë‹ˆë‹¤.";
    });

    socket.on("gameOver", ({ winner }) => {
      status.textContent = `ğŸ‰ í”Œë ˆì´ì–´ ${winner} ìŠ¹ë¦¬!`;
      myTurn = false;
    });

    socket.on("reset", () => {
      status.textContent = "ìƒëŒ€ê°€ í‡´ì¥í–ˆìŠµë‹ˆë‹¤. ê²Œì„ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.";
      boardEl.innerHTML = "";
    });
  </script>
</body>
</html>
