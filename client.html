<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>실시간 분수 통분 오목</title>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f0f0; padding: 10px; }
    #board { display: grid; grid-template-columns: repeat(7, 1fr); max-width: 600px; margin: auto; gap: 5px; }
    .cell { background: #fff; border: 1px solid #ccc; height: 60px; line-height: 60px; font-size: 24px; cursor: pointer; }
    .cell.player1 { background: #aee1f9; }
    .cell.player2 { background: #f9b2b2; }
  </style>
</head>
<body>
  <h1>실시간 분수 통분 오목</h1>
  <p id="status">연결 중...</p>
  <div id="board"></div>

  <script>
    const socket = io("https://fraction-4mok.onrender.com");
    const boardEl = document.getElementById("board");
    const status = document.getElementById("status");
    const SIZE = 7;
    let player = 0;
    let myTurn = false;

    function drawBoard(board) {
      boardEl.innerHTML = "";
      board.forEach((row, r) => {
        row.forEach((cell, c) => {
          const div = document.createElement("div");
          div.className = "cell" + (cell ? ` player${cell}` : "");
          div.onclick = () => {
            if (myTurn && !cell) socket.emit("submit", { row: r, col: c });
          };
          boardEl.appendChild(div);
        });
      });
    }

    socket.on("connect", () => {
      status.textContent = "게임에 연결되었습니다. 대기 중...";
    });

    socket.on("full", () => {
      status.textContent = "방이 가득 찼습니다.";
    });

    socket.on("playerNumber", (num) => {
      player = num;
      status.textContent = `당신은 플레이어 ${num}입니다.`;
    });

    socket.on("boardUpdate", ({ board, currentPlayer }) => {
      drawBoard(board);
      myTurn = currentPlayer === player;
      status.textContent = myTurn ? "당신의 차례입니다." : "상대 차례입니다.";
    });

    socket.on("moveMade", ({ row, col, player }) => {
      const index = row * SIZE + col;
      const cell = boardEl.children[index];
      if (cell) cell.className = `cell player${player}`;
    });

    socket.on("turnUpdate", (cp) => {
      myTurn = cp === player;
      status.textContent = myTurn ? "당신의 차례입니다." : "상대 차례입니다.";
    });

    socket.on("gameOver", ({ winner }) => {
      status.textContent = `🎉 플레이어 ${winner} 승리!`;
      myTurn = false;
    });

    socket.on("reset", () => {
      status.textContent = "상대가 퇴장했습니다. 게임이 초기화됩니다.";
      boardEl.innerHTML = "";
    });
  </script>
</body>
</html>
